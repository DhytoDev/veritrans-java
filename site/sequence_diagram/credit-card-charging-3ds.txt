@startuml
title Credit Card Charging With 3D Secure Authentication

activate Customer
activate Browser

Customer -> Browser: Checkout
Browser -> Merchant: Checkout

activate Merchant
Merchant -> Merchant: Process Checkout

Browser <- Merchant: Render Checkout Page
deactivate Merchant

Customer <- Browser: Checkout Page
Customer -> Browser: Enter CC Details

group Veritrans JavaScript Client
Browser -> Veritrans: Get Token for CC
activate Veritrans

Browser <- Veritrans: Token + Redirect URL to Bank 3D Secure Page
Browser -> Bank: Request 3D Secure Page

activate Bank
Browser <- Bank: Render 3D Secure Page
Customer <- Browser: 3D Secure Page
Customer -> Browser: Fill 3D Secure OTP
Browser -> Bank: Submit 3D Secure OTP
Browser <- Bank: Redirect to Veritrans 3D Secure Success
deactivate Bank

Browser -> Veritrans: 3D Secure Success
Browser <- Veritrans: Render 3D Secure Sucess (Post Event)
Browser -> Merchant: Charge CC with Token
activate Merchant
end

group Veritrans Java Client
Merchant -> Veritrans: Charge CC with Token
activate Veritrans

Merchant <- Veritrans: Charge Result
deactivate Veritrans
end

Merchant -> Merchant: Record Payment

Browser <- Merchant: Render Success / Fail Page
deactivate Merchant

Customer <- Browser: Show Success / Fail Page

deactivate Browser
deactivate Customer
@enduml
